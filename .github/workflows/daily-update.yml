name: Update LoL Data

# Se lance tous les jours Ã  8h00 du matin
on:
  schedule:
    - cron: '0 8 * * *'
  # Permet aussi de le lancer manuellement depuis l'interface GitHub pour tester
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-items:
    runs-on: ubuntu-latest

    steps:
    - name: RÃ©cupÃ©rer le code
      uses: actions/checkout@v4

    - name: Installer Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Installer les dÃ©pendances (nÃ©cessaire pour le script)
      run: npm ci

    - name: Lancer le script de mise Ã  jour
      run: npm run update-data

    - name: VÃ©rifier s'il y a des changements
      id: check_changes
      run: |
        if [[ -n $(git status --porcelain) ]]; then
          echo "changes=true" >> $GITHUB_OUTPUT
        else
          echo "changes=false" >> $GITHUB_OUTPUT
        fi

    - name: Commit et Push si changements
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        git config --global user.name 'LoL Quiz Bot'
        git config --global user.email 'bot@noreply.github.com'
        # C'est ici que j'ai fait la modification :
        git add src/data/items_fr.json src/data/items_en.json src/utils/constants.js
        git commit -m "ðŸ¤– Mise Ã  jour automatique des items (Patch)"
        git push
